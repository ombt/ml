
source("C:/Users/rumormx/Documents/sandbox/phm/rlib/phm_db_utils.R")

idaqowner.tbls <- c(
    "T$IDAQ_LOGFILES",
    "T$IDAQ_LOGDETAILS",
    "T$IDAQ_ALEODR_DATE_RANGE",
    "T$ICQ_WAMBULKDATAREADS",
    "T$ICQ_WAMBULKDATA",
    "T$ICQ_WAM",
    "T$ICQ_VACUUMPRESSUREDATA",
    "T$ICQ_TEMPERATURE",
    "T$ICQ_TEKNICMOTOR",
    "T$ICQ_SCRIPTING",
    "T$ICQ_RESULTS_WAVELENGTHREADS",
    "T$ICQ_RESULTS_READS",
    "T$ICQ_RESULTS",
    "T$ICQ_REAGENTOPERATIONS",
    "T$ICQ_REAGENTCOOLER",
    "T$ICQ_PMRAWDATAREADS",
    "T$ICQ_PMRAWDATA",
    "T$ICQ_PMEVENTS",
    "T$ICQ_PIPTR_SYRNG_BKLASH",
    "T$ICQ_OSHEALTHMONITORINGDATA",
    "T$ICQ_OPTICSRAWDATA",
    "T$ICQ_OPTICSHIGHRESOLUTIONDATA",
    "T$ICQ_OPTICSHIGHRESDATAREAD",
    "T$ICQ_NAVSERVICEDATA",
    "T$ICQ_MNDRECORDDATA",
    "T$ICQ_MNDHISTORY",
    "T$ICQ_MESSAGEHISTORY",
    "T$ICQ_LOWLEVELOPERATIONS",
    "T$ICQ_LLDNOISE",
    "T$ICQ_LIQUIDLEVELDETECTIONSIA",
    "T$ICQ_LIQUIDLEVELDETECTIONSCC",
    "T$ICQ_ITVDATA",
    "T$ICQ_INSTRUMENTEVENTS",
    "T$ICQ_INSTRUMENTACTIVITY",
    "T$ICQ_INDHTWAVEFORMREAD",
    "T$ICQ_INDHTWAVEFORM",
    "T$ICQ_INDHTRUNPROF_RESP",
    "T$ICQ_ICBSOLWAVEFORMREAD",
    "T$ICQ_ICBSOLENOIDWAVEFORM",
    "T$ICQ_ICBMOTORMOVE",
    "T$ICQ_IARM",
    "T$ICQ_IAASSAYACTIVITY",
    "T$ICQ_HEATERDUTYCYCLE",
    "T$ICQ_EXPERIMENTPROCESSING",
    "T$ICQ_CONSTITUENT",
    "T$ICQ_CCWATERBATHREFILL",
    "T$ICQ_CCWASHPM",
    "T$ICQ_CCSAMPLEWASHPCI",
    "T$ICQ_CCSAMPLEWASHOTHER",
    "T$ICQ_CCSAMPLEDISPCI",
    "T$ICQ_CCSAMPLEDISOTHER",
    "T$ICQ_CCSAMPLEASPPCI",
    "T$ICQ_CCSAMPLEASPOTHER",
    "T$ICQ_CCREAGTCARSLTEKNICMTR",
    "T$ICQ_CCREAGTCARSLCOOLRTEMP",
    "T$ICQ_CCREAGENTWASHPCI",
    "T$ICQ_CCREAGENTWASHOTHER",
    "T$ICQ_CCREAGENTDISPCI",
    "T$ICQ_CCREAGENTDISOTHER",
    "T$ICQ_CCREAGENTASPPCI",
    "T$ICQ_CCREAGENTASPOTHER",
    "T$ICQ_CCPIPETTORPMRAWREADS",
    "T$ICQ_CCPIPETTORPMRAWDATA",
    "T$ICQ_CCPHOTODATA",
    "T$ICQ_CCOPTICSADJTRIGSENSOR",
    "T$ICQ_CCLAMPMONITORDATA",
    "T$ICQ_CCDISPENSEPM",
    "T$ICQ_CCCUVETTEWASHWATERVOL",
    "T$ICQ_CCBULKSOLUTIONMON",
    "T$ICQ_CCBULKSOLUTIONCONSUMED",
    "T$ICQ_CCASSAYACTIVITY",
    "T$ICQ_CCASPIRATIONPM",
    "T$ICQ_CALIBRATIONRESULTCOMP",
    "T$ICQ_CALCURVE",
    "T$ICQ_BULKSOLSTATUS",
    "T$BSQ_WSHZNINITVCMPR",
    "T$BSQ_WASHZONEDISPMSCOREDATA",
    "T$BSQ_WASHZONEDISPMRESULTDATA",
    "T$BSQ_WASHZONEDISPMRAWREADS",
    "T$BSQ_WASHZONEDISPMRAWDATA",
    "T$BSQ_WASHZONEASPPMSCOREDATA",
    "T$BSQ_WASHZONEASPPMRAWREADS",
    "T$BSQ_WASHZONEASPPMRAWDATA",
    "T$BSQ_WASHSTNEVACPMRESULT",
    "T$BSQ_WAMPMRESULT",
    "T$BSQ_TRIGGERPRETRIGSCOREDATA",
    "T$BSQ_TRIGGERPRETRIGRAWREAD",
    "T$BSQ_TRIGGERPRETRIGGERRAW",
    "T$BSQ_TEST",
    "T$BSQ_TEMPERATUREDATA",
    "T$BSQ_TEKNICMOTOR",
    "T$BSQ_SYSTEMOPERATION",
    "T$BSQ_SCRIPTING",
    "T$BSQ_SAMPLEOPERATION",
    "T$BSQ_RESULTS_READS",
    "T$BSQ_RESULTS",
    "T$BSQ_REAGENTOPERATION",
    "T$BSQ_PROCESSPATH",
    "T$BSQ_PIPTR_SYRNG_BKLASH",
    "T$BSQ_PIPTRDISPPMRAWREAD",
    "T$BSQ_PIPTRDISPNPMSCOREDATA",
    "T$BSQ_PIPTRDISPNPMRAWDATA",
    "T$BSQ_PIPETTORWASHPMSCORE",
    "T$BSQ_PIPETTORWASHPMRAWREAD",
    "T$BSQ_PIPETTORWASHPMRAW",
    "T$BSQ_PIPETTORWASHPM",
    "T$BSQ_PIPETTORPMRAWDATAREADS",
    "T$BSQ_PIPETTORPMRAWDATA",
    "T$BSQ_PIPETTORPM",
    "T$BSQ_PIPETTOROPERATION",
    "T$BSQ_OSHEALTHMONITORINGDATA",
    "T$BSQ_OPTICSHIGHRESOLUTIONDATA",
    "T$BSQ_OPTICSHIGHRESDATAREAD",
    "T$BSQ_OPTICSDISPMRESULT",
    "T$BSQ_NAVSERVICEDATA",
    "T$BSQ_MNDRECORDDATA",
    "T$BSQ_MNDHISTORY",
    "T$BSQ_MESSAGEHISTORY",
    "T$BSQ_LOWLEVELOPERATION",
    "T$BSQ_LLDNOISE",
    "T$BSQ_LIQUIDWASTESCOREDATA",
    "T$BSQ_LIQUIDWASTERAWREAD",
    "T$BSQ_LIQUIDWASTERAWDATA",
    "T$BSQ_LIQUIDLEVELDETECTIONS",
    "T$BSQ_ITVDATA",
    "T$BSQ_INSTRUMENTEVENT",
    "T$BSQ_INSTRUMENTACTIVITY",
    "T$BSQ_INDUCTIONHTRWAVEFREAD",
    "T$BSQ_INDUCTIONHTRWAVEFORM",
    "T$BSQ_INDCTNHTRRUNPROFRSPNS",
    "T$BSQ_ICBMOTORMOVE",
    "T$BSQ_IARM",
    "T$BSQ_EXPERIMENTPROCESSING",
    "T$BSQ_CALCURVE",
    "IDAQ_SYSTEMINFORMATION_16APR",
    "IDAQ_SYSTEMINFORMATION",
    "IDAQ_SERVERQUEUE",
    "IDAQ_REL_CUSTOMER_TEMP",
    "IDAQ_REJECTED_DEV_BKP_4FEB19",
    "IDAQ_REJECTED_DEVICES",
    "IDAQ_PRODUCTLINEFAMILY",
    "IDAQ_ODRREQUESTTABLES",
    "IDAQ_ODRREQUESTS",
    "IDAQ_ODRREQUESTDEVICES",
    "IDAQ_MODULESNPLXREF",
    "IDAQ_MODULEINFORMATION_16APR",
    "IDAQ_MODULEINFORMATION",
    "IDAQ_MESSAGES",
    "IDAQ_LOGIMPLEMENTATIONS",
    "IDAQ_LOGFILES",
    "IDAQ_LOGDETAILS",
    "IDAQ_DATASYNC_CUSTOMER_TEMP",
    "IDAQ_DATALASTPROCESSED",
    "IDAQ_CUSTOMERINFORMATION_30MAR",
    "IDAQ_CUSTOMERINFORMATION_16APR",
    "IDAQ_CUSTOMERINFORMATION",
    "IDAQ_CONFIG_PARAM",
    "IDAQ_ALEODR_DATE_RANGE",
    "ICQ_WAMBULKDATAREADS",
    "ICQ_WAMBULKDATA",
    "ICQ_WAM",
    "ICQ_VACUUMPRESSUREDATA",
    "ICQ_TEMPERATURE",
    "ICQ_TEKNICMOTOR",
    "ICQ_SCRIPTING",
    "ICQ_RESULTS_WAVELENGTHREADS",
    "ICQ_RESULTS_READS",
    "ICQ_RESULTS",
    "ICQ_REAGENTOPERATIONS",
    "ICQ_REAGENTCOOLER",
    "ICQ_PMRAWDATAREADS",
    "ICQ_PMRAWDATA",
    "ICQ_PMEVENTS",
    "ICQ_PIPTR_SYRNG_BKLASH",
    "ICQ_OSHEALTHMONITORINGDATA",
    "ICQ_OPTICSRAWDATA",
    "ICQ_OPTICSHIGHRESOLUTIONDATA",
    "ICQ_OPTICSHIGHRESDATAREAD",
    "ICQ_NAVSERVICEDATA",
    "ICQ_MNDRECORDDATA",
    "ICQ_MNDHISTORY",
    "ICQ_MESSAGEHISTORY",
    "ICQ_LOWLEVELOPERATIONS",
    "ICQ_LLDNOISE",
    "ICQ_LIQUIDLEVELDETECTIONSIA",
    "ICQ_LIQUIDLEVELDETECTIONSCC",
    "ICQ_ITVDATA",
    "ICQ_INSTRUMENTEVENTS",
    "ICQ_INSTRUMENTACTIVITY",
    "ICQ_INDHTWAVEFORMREAD",
    "ICQ_INDHTWAVEFORM",
    "ICQ_INDHTRUNPROF_RESP",
    "ICQ_ICBSOLWAVEFORMREAD",
    "ICQ_ICBSOLENOIDWAVEFORM",
    "ICQ_ICBMOTORMOVE",
    "ICQ_IARM",
    "ICQ_IAASSAYACTIVITY",
    "ICQ_HEATERDUTYCYCLE",
    "ICQ_EXPERIMENTPROCESSING",
    "ICQ_CONSTITUENT",
    "ICQ_CCWATERBATHREFILL",
    "ICQ_CCWASHPM",
    "ICQ_CCSAMPLEWASHPCI",
    "ICQ_CCSAMPLEWASHOTHER",
    "ICQ_CCSAMPLEDISPCI",
    "ICQ_CCSAMPLEDISOTHER",
    "ICQ_CCSAMPLEASPPCI",
    "ICQ_CCSAMPLEASPOTHER",
    "ICQ_CCREAGTCARSLTEKNICMTR",
    "ICQ_CCREAGTCARSLCOOLRTEMP",
    "ICQ_CCREAGENTWASHPCI",
    "ICQ_CCREAGENTWASHOTHER",
    "ICQ_CCREAGENTDISPCI",
    "ICQ_CCREAGENTDISOTHER",
    "ICQ_CCREAGENTASPPCI",
    "ICQ_CCREAGENTASPOTHER",
    "ICQ_CCPIPETTORPMRAWREADS",
    "ICQ_CCPIPETTORPMRAWDATA",
    "ICQ_CCPHOTODATA",
    "ICQ_CCOPTICSADJTRIGSENSOR",
    "ICQ_CCLAMPMONITORDATA",
    "ICQ_CCDISPENSEPM",
    "ICQ_CCCUVETTEWASHWATERVOL",
    "ICQ_CCBULKSOLUTIONMON",
    "ICQ_CCBULKSOLUTIONCONSUMED",
    "ICQ_CCASSAYACTIVITY",
    "ICQ_CCASPIRATIONPM",
    "ICQ_CALIBRATIONRESULTCOMP",
    "ICQ_CALCURVE",
    "ICQ_BULKSOLSTATUS",
    "BSQ_WSHZNINITVCMPR",
    "BSQ_WASHZONEDISPMSCOREDATA",
    "BSQ_WASHZONEDISPMRESULTDATA",
    "BSQ_WASHZONEDISPMRAWREADS",
    "BSQ_WASHZONEDISPMRAWDATA",
    "BSQ_WASHZONEASPPMSCOREDATA",
    "BSQ_WASHZONEASPPMRAWREADS",
    "BSQ_WASHZONEASPPMRAWDATA",
    "BSQ_WASHSTNEVACPMRESULT",
    "BSQ_WAMPMRESULT",
    "BSQ_TRIGGERPRETRIGSCOREDATA",
    "BSQ_TRIGGERPRETRIGRAWREAD",
    "BSQ_TRIGGERPRETRIGGERRAW",
    "BSQ_TEST",
    "BSQ_TEMPERATUREDATA",
    "BSQ_TEKNICMOTOR",
    "BSQ_SYSTEMOPERATION",
    "BSQ_SCRIPTING",
    "BSQ_SAMPLEOPERATION",
    "BSQ_RESULTS_READS",
    "BSQ_RESULTS",
    "BSQ_REAGENTOPERATION",
    "BSQ_PROCESSPATH",
    "BSQ_PIPTR_SYRNG_BKLASH",
    "BSQ_PIPTRDISPPMRAWREAD",
    "BSQ_PIPTRDISPNPMSCOREDATA",
    "BSQ_PIPTRDISPNPMRAWDATA",
    "BSQ_PIPETTORWASHPMSCORE",
    "BSQ_PIPETTORWASHPMRAWREAD",
    "BSQ_PIPETTORWASHPMRAW",
    "BSQ_PIPETTORWASHPM",
    "BSQ_PIPETTORPMRAWDATAREADS",
    "BSQ_PIPETTORPMRAWDATA",
    "BSQ_PIPETTORPM",
    "BSQ_PIPETTOROPERATION",
    "BSQ_OSHEALTHMONITORINGDATA",
    "BSQ_OPTICSHIGHRESOLUTIONDATA",
    "BSQ_OPTICSHIGHRESDATAREAD",
    "BSQ_OPTICSDISPMRESULT",
    "BSQ_NAVSERVICEDATA",
    "BSQ_MNDRECORDDATA",
    "BSQ_MNDHISTORY",
    "BSQ_MESSAGEHISTORY",
    "BSQ_LOWLEVELOPERATION",
    "BSQ_LLDNOISE",
    "BSQ_LIQUIDWASTESCOREDATA",
    "BSQ_LIQUIDWASTERAWREAD",
    "BSQ_LIQUIDWASTERAWDATA",
    "BSQ_LIQUIDLEVELDETECTIONS",
    "BSQ_ITVDATA",
    "BSQ_INSTRUMENTEVENT",
    "BSQ_INSTRUMENTACTIVITY",
    "BSQ_INDUCTIONHTRWAVEFREAD",
    "BSQ_INDUCTIONHTRWAVEFORM",
    "BSQ_INDCTNHTRRUNPROFRSPNS",
    "BSQ_ICBMOTORMOVE",
    "BSQ_IARM",
    "BSQ_EXPERIMENTPROCESSING",
    "BSQ_CALCURVE",
    "ADD_INSTRUMENT_MSTR_TEMP"
)

icq.tbls <- idaqowner.tbls[grepl("^ICQ", idaqowner.tbls)]

do_query <- function(tbl, db_conn) {
    print(tbl)
    query <- sprintf("
select 
    max(logdate_local) as max_date, 
    count(distinct modulesn) as cnt_modsn,
    count(distinct systemsn) as cnt_syssn
from
    idaqowner.%s
where
    to_timestamp('04/01/2019 00:00:00', 
                 'MM/DD/YYYY HH24:MI:SS') <= logdate_local", tbl)
    return(
        tryCatch(ida_exec_query(db_conn, query), 
                 error=function(e) { NULL }))
}

db_conn <- connect_to_pabbto()

results <- lapply(icq.tbls, do_query, db_conn)

ida_close_db(db_conn)

icq.tbls.results<-cbind(icq.tbls,results)

write.csv(icq.tbls.results,file="icq.tbls.csv",row.names=FALSE)

